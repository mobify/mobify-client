<script>
	// This is an intermediate page that sets up state (window.name, cookies)
	// for a page that is about to be tested.

	var payload = decodeURIComponent(window.location.search.substring(1));
	
	// Allow #{...} templating on initialization parameters
	var values = {
		host: location.hostname
	}

	payload = payload.replace(/#\{([^\}]+)\}/, function(all, key) {
		if (key in values) return values[key];
		return all;
	});

	var params = JSON.parse(payload);

    if (params.name) window.name = params.name;

    if (params.cookie) {
	    [].forEach.call(params.cookie, function(cookieValue) {
	    	document.cookie = cookieValue;
	    });
	}

    location.href = params.href;

</script>